name: CI TelcoVision

on:
  push:
    branches: [ main, ci_cd ]
  pull_request:
    branches: [ main, ci_cd ]

jobs:
  run_pipeline:
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ§  Clonar repositorio
      uses: actions/checkout@v4

    - name: ğŸ Configurar Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    - name: ğŸ“¦ Instalar dependencias
      run: |
        pip install -r requirements.txt
        pip install dvc[all]

        - name: ğŸ” Configurar credenciales de DagsHub (HTTP)
      env:
        DAGSHUB_USER: ${{ secrets.DAGSHUB_USER }}
        DAGSHUB_TOKEN: ${{ secrets.DAGSHUB_TOKEN }}
      run: |
        echo "machine dagshub.com login $DAGSHUB_USER password $DAGSHUB_TOKEN" > ~/.netrc
        echo "DAGSHUB_USER=$DAGSHUB_USER" >> $GITHUB_ENV
        echo "DAGSHUB_TOKEN=$DAGSHUB_TOKEN" >> $GITHUB_ENV

    - name: ğŸ” Configurar credenciales DagsHub (S3)
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.DAGSHUB_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.DAGSHUB_SECRET_ACCESS_KEY }}
      run: echo "S3 credentials ready."
      
    - name: ğŸ“¥ Descargar datos versionados (DVC)
      run: dvc pull

    - name: âš™ï¸ Ejecutar pipeline TelcoVision
      run: dvc repro

    - name: ğŸ“Š Mostrar mÃ©tricas
      run: cat metrics.json
