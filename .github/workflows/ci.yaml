name: CI TelcoVision

on:
  push:
    branches: [ main, ci_cd ]
  pull_request:
    branches: [ main, ci_cd ]

jobs:
  run_pipeline:
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ§  Clonar repositorio
      uses: actions/checkout@v4

    - name: ğŸ Configurar Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    - name: ğŸ“¦ Instalar dependencias
      run: |
        pip install -r requirements.txt
        pip install dvc[all]

    - name: ğŸ” Configurar credenciales de DagsHub
      env:
        DAGSHUB_USER: "edisonjef"
        DAGSHUB_TOKEN: "838331baac64c93dae8315a9defd4a4449bc936a"
      run: |
        # Guardar credenciales de Git para que DVC pueda acceder al remoto
        echo "machine dagshub.com login $DAGSHUB_USER password $DAGSHUB_TOKEN" > ~/.netrc
        
        # Exportar variables de entorno (necesarias para DVC >=3.x)
        echo "DAGSHUB_USER=$DAGSHUB_USER" >> $GITHUB_ENV
        echo "DAGSHUB_TOKEN=$DAGSHUB_TOKEN" >> $GITHUB_ENV

        # Mostrar el remoto configurado
        dvc remote list
    - name: ğŸ“¥ Descargar datos versionados (DVC)
      run: dvc pull

    - name: âš™ï¸ Ejecutar pipeline TelcoVision
      run: dvc repro

    - name: ğŸ“Š Mostrar mÃ©tricas
      run: cat metrics.json
